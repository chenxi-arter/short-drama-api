<svg width="2000" height="1400" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .entity-box { fill: #ffffff; stroke: #2c3e50; stroke-width: 2; rx: 6; }
      .entity-title { font-family: 'Segoe UI', Arial, sans-serif; font-size: 15px; font-weight: bold; fill: #2c3e50; }
      .field-text { font-family: 'Consolas', 'Monaco', monospace; font-size: 11px; fill: #34495e; }
      .pk { fill: #e74c3c; font-weight: bold; }
      .fk { fill: #3498db; }
      .relation-line { stroke: #95a5a6; stroke-width: 1.5; fill: none; marker-end: url(#arrow); }
      .relation-text { font-family: Arial, sans-serif; font-size: 10px; fill: #7f8c8d; text-anchor: middle; }
      .section-bg { fill: #ecf0f1; stroke: #bdc3c7; stroke-width: 1; rx: 4; }
    </style>
    <marker id="arrow" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#95a5a6" />
    </marker>
  </defs>

  <!-- æ ‡é¢˜ -->
  <text x="1000" y="30" style="font-size: 22px; font-weight: bold; fill: #2c3e50; text-anchor: middle;">çŸ­å‰§APIç³»ç»Ÿ - å®Œæ•´æ•°æ®åº“å®ä½“å…³ç³»å›¾</text>
  <text x="1000" y="52" style="font-size: 13px; fill: #7f8c8d; text-anchor: middle;">Database Entity Relationship Diagram - Complete Version (v2.1)</text>

  <!-- ========== ç¬¬ä¸€è¡Œï¼šæ ¸å¿ƒå®ä½“ ========== -->
  
  <!-- User -->
  <rect x="50" y="80" width="280" height="280" class="entity-box"/>
  <rect x="50" y="80" width="280" height="30" class="section-bg"/>
  <text x="190" y="100" class="entity-title">ğŸ‘¤ User (ç”¨æˆ·)</text>
  <text x="60" y="125" class="field-text pk">â–¸ id: BIGINT PRIMARY KEY</text>
  <text x="60" y="142" class="field-text">  uuid: VARCHAR(36) UNIQUE</text>
  <text x="60" y="159" class="field-text">  telegram_id: BIGINT UNIQUE</text>
  <text x="60" y="176" class="field-text">  username: VARCHAR(255)</text>
  <text x="60" y="193" class="field-text">  first_name: VARCHAR(255)</text>
  <text x="60" y="210" class="field-text">  last_name: VARCHAR(255)</text>
  <text x="60" y="227" class="field-text">  email: VARCHAR(255)</text>
  <text x="60" y="244" class="field-text">  password_hash: VARCHAR(255)</text>
  <text x="60" y="261" class="field-text">  photo_url: TEXT</text>
  <text x="60" y="278" class="field-text">  is_active: BOOLEAN DEFAULT TRUE</text>
  <text x="60" y="295" class="field-text">  language_code: VARCHAR(10)</text>
  <text x="60" y="312" class="field-text">  created_at: TIMESTAMP</text>
  <text x="60" y="329" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="60" y="346" class="field-text">  last_login_at: TIMESTAMP</text>

  <!-- Category -->
  <rect x="370" y="80" width="280" height="220" class="entity-box"/>
  <rect x="370" y="80" width="280" height="30" class="section-bg"/>
  <text x="510" y="100" class="entity-title">ğŸ“ Category (åˆ†ç±»)</text>
  <text x="380" y="125" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="380" y="142" class="field-text">  category_id: VARCHAR(50) UNIQUE</text>
  <text x="380" y="159" class="field-text">  name: VARCHAR(50) NOT NULL</text>
  <text x="380" y="176" class="field-text">  type: INT</text>
  <text x="380" y="193" class="field-text">  index: INT</text>
  <text x="380" y="210" class="field-text">  route_name: VARCHAR(50)</text>
  <text x="380" y="227" class="field-text">  style_type: INT</text>
  <text x="380" y="244" class="field-text">  is_enabled: BOOLEAN DEFAULT TRUE</text>
  <text x="380" y="261" class="field-text">  created_at: TIMESTAMP</text>
  <text x="380" y="278" class="field-text">  updated_at: TIMESTAMP</text>

  <!-- Series -->
  <rect x="690" y="80" width="300" height="340" class="entity-box"/>
  <rect x="690" y="80" width="300" height="30" class="section-bg"/>
  <text x="840" y="100" class="entity-title">ğŸ¬ Series (å‰§é›†ç³»åˆ—)</text>
  <text x="700" y="125" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="700" y="142" class="field-text">  uuid: VARCHAR(36) UNIQUE</text>
  <text x="700" y="159" class="field-text">  short_id: VARCHAR(11) UNIQUE</text>
  <text x="700" y="176" class="field-text">  title: VARCHAR(255) NOT NULL</text>
  <text x="700" y="193" class="field-text">  description: TEXT</text>
  <text x="700" y="210" class="field-text">  cover_url: VARCHAR(255)</text>
  <text x="700" y="227" class="field-text fk">  category_id: INT</text>
  <text x="700" y="244" class="field-text">  total_episodes: INT DEFAULT 0</text>
  <text x="700" y="261" class="field-text">  score: FLOAT</text>
  <text x="700" y="278" class="field-text">  play_count: INT DEFAULT 0</text>
  <text x="700" y="295" class="field-text">  starring: TEXT</text>
  <text x="700" y="312" class="field-text">  actor: TEXT</text>
  <text x="700" y="329" class="field-text">  director: VARCHAR(255)</text>
  <text x="700" y="346" class="field-text">  release_date: DATE</text>
  <text x="700" y="363" class="field-text">  is_active: BOOLEAN DEFAULT TRUE</text>
  <text x="700" y="380" class="field-text">  created_at: TIMESTAMP</text>
  <text x="700" y="397" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="700" y="414" class="field-text">  deleted_at: TIMESTAMP NULL</text>

  <!-- Episode -->
  <rect x="1030" y="80" width="300" height="340" class="entity-box"/>
  <rect x="1030" y="80" width="300" height="30" class="section-bg"/>
  <text x="1180" y="100" class="entity-title">ğŸ“º Episode (å‰§é›†)</text>
  <text x="1040" y="125" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="1040" y="142" class="field-text">  uuid: VARCHAR(36) UNIQUE</text>
  <text x="1040" y="159" class="field-text">  short_id: VARCHAR(11) UNIQUE</text>
  <text x="1040" y="176" class="field-text fk">  series_id: INT NOT NULL</text>
  <text x="1040" y="193" class="field-text">  episode_number: INT NOT NULL</text>
  <text x="1040" y="210" class="field-text">  title: VARCHAR(255)</text>
  <text x="1040" y="227" class="field-text">  description: TEXT</text>
  <text x="1040" y="244" class="field-text">  video_url: VARCHAR(255)</text>
  <text x="1040" y="261" class="field-text">  cover_url: VARCHAR(255)</text>
  <text x="1040" y="278" class="field-text">  duration: INT</text>
  <text x="1040" y="295" class="field-text">  status: VARCHAR(20)</text>
  <text x="1040" y="312" class="field-text">  play_count: INT DEFAULT 0</text>
  <text x="1040" y="329" class="field-text">  access_key: VARCHAR(64)</text>
  <text x="1040" y="346" class="field-text">  like_count: INT DEFAULT 0</text>
  <text x="1040" y="363" class="field-text">  dislike_count: INT DEFAULT 0</text>
  <text x="1040" y="380" class="field-text">  created_at: TIMESTAMP</text>
  <text x="1040" y="397" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="1040" y="414" class="field-text">  deleted_at: TIMESTAMP NULL</text>

  <!-- ========== ç¬¬äºŒè¡Œï¼šè¯„è®ºç³»ç»Ÿ ========== -->
  
  <!-- Comment -->
  <rect x="50" y="460" width="300" height="280" class="entity-box"/>
  <rect x="50" y="460" width="300" height="30" class="section-bg"/>
  <text x="200" y="480" class="entity-title">ğŸ’¬ Comment (è¯„è®º)</text>
  <text x="60" y="505" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="60" y="522" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="60" y="539" class="field-text fk">  episode_id: INT NOT NULL</text>
  <text x="60" y="556" class="field-text">  content: TEXT NOT NULL</text>
  <text x="60" y="573" class="field-text">  appear_second: INT</text>
  <text x="60" y="590" class="field-text">  parent_id: INT NULL</text>
  <text x="60" y="607" class="field-text">  reply_to_user_id: BIGINT NULL</text>
  <text x="60" y="624" class="field-text">  floor_number: INT</text>
  <text x="60" y="641" class="field-text">  like_count: INT DEFAULT 0</text>
  <text x="60" y="658" class="field-text">  reply_count: INT DEFAULT 0</text>
  <text x="60" y="675" class="field-text">  is_deleted: BOOLEAN DEFAULT FALSE</text>
  <text x="60" y="692" class="field-text">  created_at: TIMESTAMP</text>
  <text x="60" y="709" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="60" y="726" class="field-text">  deleted_at: TIMESTAMP NULL</text>

  <!-- CommentLikes -->
  <rect x="390" y="460" width="300" height="180" class="entity-box"/>
  <rect x="390" y="460" width="300" height="30" class="section-bg"/>
  <text x="540" y="480" class="entity-title">ğŸ‘ CommentLikes (è¯„è®ºç‚¹èµ)</text>
  <text x="400" y="505" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="400" y="522" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="400" y="539" class="field-text fk">  comment_id: INT NOT NULL</text>
  <text x="400" y="556" class="field-text">  created_at: DATETIME(6)</text>
  <text x="400" y="573" class="field-text">  </text>
  <text x="400" y="590" class="field-text">  UNIQUE KEY (user_id, comment_id)</text>
  <text x="400" y="607" class="field-text">  INDEX idx_user_id (user_id)</text>
  <text x="400" y="624" class="field-text">  INDEX idx_comment_id (comment_id)</text>

  <!-- ========== ç¬¬ä¸‰è¡Œï¼šäº¤äº’å®ä½“ ========== -->
  
  <!-- EpisodeReactions -->
  <rect x="730" y="460" width="300" height="200" class="entity-box"/>
  <rect x="730" y="460" width="300" height="30" class="section-bg"/>
  <text x="880" y="480" class="entity-title">âš¡ EpisodeReactions (å‰§é›†ååº”)</text>
  <text x="740" y="505" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="740" y="522" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="740" y="539" class="field-text fk">  episode_id: INT NOT NULL</text>
  <text x="740" y="556" class="field-text">  reaction_type: VARCHAR(20)</text>
  <text x="740" y="573" class="field-text">    ('like' | 'dislike')</text>
  <text x="740" y="590" class="field-text">  created_at: DATETIME(6)</text>
  <text x="740" y="607" class="field-text">  updated_at: DATETIME(6)</text>
  <text x="740" y="624" class="field-text">  </text>
  <text x="740" y="641" class="field-text">  UNIQUE KEY (user_id, episode_id)</text>

  <!-- Favorites -->
  <rect x="1070" y="460" width="300" height="200" class="entity-box"/>
  <rect x="1070" y="460" width="300" height="30" class="section-bg"/>
  <text x="1220" y="480" class="entity-title">â­ Favorites (æ”¶è—)</text>
  <text x="1080" y="505" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="1080" y="522" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="1080" y="539" class="field-text fk">  series_id: INT NOT NULL</text>
  <text x="1080" y="556" class="field-text">  episode_id: INT NULL</text>
  <text x="1080" y="573" class="field-text">  favorite_type: VARCHAR(20)</text>
  <text x="1080" y="590" class="field-text">  created_at: DATETIME(6)</text>
  <text x="1080" y="607" class="field-text">  updated_at: DATETIME(6)</text>
  <text x="1080" y="624" class="field-text">  </text>
  <text x="1080" y="641" class="field-text">  UNIQUE KEY (user_id, series_id)</text>

  <!-- WatchProgress -->
  <rect x="1410" y="460" width="300" height="180" class="entity-box"/>
  <rect x="1410" y="460" width="300" height="30" class="section-bg"/>
  <text x="1560" y="480" class="entity-title">â¯ï¸ WatchProgress (è§‚çœ‹è¿›åº¦)</text>
  <text x="1420" y="505" class="field-text pk">â–¸ user_id: BIGINT</text>
  <text x="1420" y="522" class="field-text pk">â–¸ episode_id: INT</text>
  <text x="1420" y="539" class="field-text">  stop_at_second: INT DEFAULT 0</text>
  <text x="1420" y="556" class="field-text">  total_duration: INT</text>
  <text x="1420" y="573" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="1420" y="590" class="field-text">  </text>
  <text x="1420" y="607" class="field-text">  PRIMARY KEY (user_id, episode_id)</text>

  <!-- BrowseHistory -->
  <rect x="50" y="780" width="320" height="240" class="entity-box"/>
  <rect x="50" y="780" width="320" height="30" class="section-bg"/>
  <text x="210" y="800" class="entity-title">ğŸ“Š BrowseHistory (æµè§ˆå†å²)</text>
  <text x="60" y="825" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="60" y="842" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="60" y="859" class="field-text fk">  series_id: INT NOT NULL</text>
  <text x="60" y="876" class="field-text">  browse_type: VARCHAR(50)</text>
  <text x="60" y="893" class="field-text">  last_episode_number: INT</text>
  <text x="60" y="910" class="field-text">  visit_count: INT DEFAULT 1</text>
  <text x="60" y="927" class="field-text">  user_agent: VARCHAR(500)</text>
  <text x="60" y="944" class="field-text">  ip_address: VARCHAR(45)</text>
  <text x="60" y="961" class="field-text">  created_at: DATETIME(6)</text>
  <text x="60" y="978" class="field-text">  updated_at: DATETIME(6)</text>
  <text x="60" y="995" class="field-text">  </text>
  <text x="60" y="1012" class="field-text">  INDEX idx_user_series (user_id, series_id)</text>

  <!-- RefreshToken -->
  <rect x="410" y="780" width="320" height="240" class="entity-box"/>
  <rect x="410" y="780" width="320" height="30" class="section-bg"/>
  <text x="570" y="800" class="entity-title">ğŸ”‘ RefreshToken (åˆ·æ–°ä»¤ç‰Œ)</text>
  <text x="420" y="825" class="field-text pk">â–¸ id: INT PRIMARY KEY AUTO_INCREMENT</text>
  <text x="420" y="842" class="field-text fk">  user_id: BIGINT NOT NULL</text>
  <text x="420" y="859" class="field-text">  token: VARCHAR(255) UNIQUE</text>
  <text x="420" y="876" class="field-text">  expires_at: TIMESTAMP</text>
  <text x="420" y="893" class="field-text">  is_revoked: BOOLEAN DEFAULT FALSE</text>
  <text x="420" y="910" class="field-text">  device_info: VARCHAR(500)</text>
  <text x="420" y="927" class="field-text">  ip_address: VARCHAR(45)</text>
  <text x="420" y="944" class="field-text">  user_agent: VARCHAR(500)</text>
  <text x="420" y="961" class="field-text">  created_at: TIMESTAMP</text>
  <text x="420" y="978" class="field-text">  updated_at: TIMESTAMP</text>
  <text x="420" y="995" class="field-text">  </text>
  <text x="420" y="1012" class="field-text">  INDEX idx_user_id (user_id)</text>

  <!-- ========== å…³ç³»çº¿ ========== -->
  
  <!-- Category -> Series -->
  <path d="M 650 190 L 690 190" class="relation-line"/>
  <text x="670" y="185" class="relation-text">1:N</text>

  <!-- Series -> Episode -->
  <path d="M 990 250 L 1030 250" class="relation-line"/>
  <text x="1010" y="245" class="relation-text">1:N</text>

  <!-- User -> Comment -->
  <path d="M 190 360 L 190 460" class="relation-line"/>
  <text x="205" y="410" class="relation-text">1:N</text>

  <!-- Episode -> Comment -->
  <path d="M 1180 420 L 1180 600 L 350 600" class="relation-line"/>
  <text x="765" y="595" class="relation-text">1:N</text>

  <!-- User -> CommentLikes -->
  <path d="M 330 300 L 540 300 L 540 460" class="relation-line"/>
  <text x="435" y="295" class="relation-text">1:N</text>

  <!-- Comment -> CommentLikes -->
  <path d="M 350 550 L 390 550" class="relation-line"/>
  <text x="370" y="545" class="relation-text">1:N</text>

  <!-- User -> EpisodeReactions -->
  <path d="M 330 280 L 880 280 L 880 460" class="relation-line"/>
  <text x="605" y="275" class="relation-text">1:N</text>

  <!-- Episode -> EpisodeReactions -->
  <path d="M 1180 420 L 1180 450 L 880 450 L 880 460" class="relation-line"/>
  <text x="1030" y="445" class="relation-text">1:N</text>

  <!-- User -> Favorites -->
  <path d="M 330 260 L 1220 260 L 1220 460" class="relation-line"/>
  <text x="775" y="255" class="relation-text">1:N</text>

  <!-- Series -> Favorites -->
  <path d="M 990 300 L 1220 300 L 1220 460" class="relation-line"/>
  <text x="1105" y="295" class="relation-text">1:N</text>

  <!-- User -> WatchProgress -->
  <path d="M 330 240 L 1560 240 L 1560 460" class="relation-line"/>
  <text x="945" y="235" class="relation-text">1:N</text>

  <!-- Episode -> WatchProgress -->
  <path d="M 1330 350 L 1560 350 L 1560 460" class="relation-line"/>
  <text x="1445" y="345" class="relation-text">1:N</text>

  <!-- User -> BrowseHistory -->
  <path d="M 190 360 L 190 700 L 210 700 L 210 780" class="relation-line"/>
  <text x="205" y="570" class="relation-text">1:N</text>

  <!-- Series -> BrowseHistory -->
  <path d="M 840 420 L 840 700 L 210 700 L 210 780" class="relation-line"/>
  <text x="525" y="695" class="relation-text">1:N</text>

  <!-- User -> RefreshToken -->
  <path d="M 190 360 L 190 720 L 570 720 L 570 780" class="relation-line"/>
  <text x="380" y="715" class="relation-text">1:N</text>

  <!-- ========== å›¾ä¾‹ ========== -->
  <rect x="770" y="780" width="950" height="240" fill="#f8f9fa" stroke="#dee2e6" stroke-width="2" rx="8"/>
  <text x="1245" y="810" style="font-size: 18px; font-weight: bold; fill: #2c3e50; text-anchor: middle;">æ•°æ®åº“è®¾è®¡è¯´æ˜ Database Design Notes</text>
  
  <text x="790" y="840" style="font-size: 13px; font-weight: bold; fill: #2c3e50;">å­—æ®µè¯´æ˜ Field Types:</text>
  <text x="790" y="860" class="field-text pk">â–¸ çº¢è‰²ï¼šä¸»é”® (Primary Key)</text>
  <text x="790" y="877" class="field-text fk">â–¸ è“è‰²ï¼šå¤–é”® (Foreign Key)</text>
  <text x="790" y="894" class="field-text">â–¸ é»‘è‰²ï¼šæ™®é€šå­—æ®µ (Regular Field)</text>
  
  <text x="790" y="924" style="font-size: 13px; font-weight: bold; fill: #2c3e50;">ç´¢å¼•è®¾è®¡ Indexes:</text>
  <text x="790" y="944" class="field-text">â€¢ æ‰€æœ‰å¤–é”®å­—æ®µéƒ½æœ‰ç´¢å¼•</text>
  <text x="790" y="961" class="field-text">â€¢ å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤æ•°æ®</text>
  <text x="790" y="978" class="field-text">â€¢ è”åˆç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½</text>
  <text x="790" y="995" class="field-text">â€¢ è½¯åˆ é™¤ä½¿ç”¨ deleted_at å­—æ®µ</text>

  <text x="1100" y="840" style="font-size: 13px; font-weight: bold; fill: #2c3e50;">å…³ç³»è¯´æ˜ Relationships:</text>
  <text x="1100" y="860" class="field-text">â€¢ User 1:N Comment (ç”¨æˆ·å‘è¡¨å¤šæ¡è¯„è®º)</text>
  <text x="1100" y="877" class="field-text">â€¢ Comment 1:N CommentLikes (è¯„è®ºè¢«å¤šäººç‚¹èµ)</text>
  <text x="1100" y="894" class="field-text">â€¢ Episode 1:N EpisodeReactions (å‰§é›†è¢«å¤šäººååº”)</text>
  <text x="1100" y="911" class="field-text">â€¢ Series 1:N Favorites (ç³»åˆ—è¢«å¤šäººæ”¶è—)</text>
  <text x="1100" y="928" class="field-text">â€¢ Episode 1:N WatchProgress (å‰§é›†æœ‰å¤šä¸ªè§‚çœ‹è®°å½•)</text>
  <text x="1100" y="945" class="field-text">â€¢ Series 1:N BrowseHistory (ç³»åˆ—æœ‰å¤šä¸ªæµè§ˆè®°å½•)</text>

  <text x="1450" y="840" style="font-size: 13px; font-weight: bold; fill: #2c3e50;">ç‰¹æ€§ Features:</text>
  <text x="1450" y="860" class="field-text">âœ“ UUID é˜²æšä¸¾æ”»å‡»</text>
  <text x="1450" y="877" class="field-text">âœ“ è½¯åˆ é™¤æ”¯æŒ</text>
  <text x="1450" y="894" class="field-text">âœ“ æ—¶é—´æˆ³è‡ªåŠ¨æ›´æ–°</text>
  <text x="1450" y="911" class="field-text">âœ“ çº§è”åˆ é™¤ä¿æŠ¤</text>
  <text x="1450" y="928" class="field-text">âœ“ å”¯ä¸€çº¦æŸé˜²é‡å¤</text>
  <text x="1450" y="945" class="field-text">âœ“ ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢</text>

  <!-- ç‰ˆæœ¬ä¿¡æ¯ -->
  <text x="1000" y="1100" style="font-size: 12px; fill: #95a5a6; text-anchor: middle;">
    Version 2.1 | Updated: 2025-11-19 | Total Entities: 10 | Total Fields: 120+
  </text>

</svg>
