# 系列明细数据统计参数说明


## 统计指标说明

### 1. 播放量（观看记录数）

**定义**：在指定日期范围内，有多少个"用户-剧集"对产生了观看行为。

**说明**：
- 一个用户观看一个剧集，算作1次播放量
- 如果用户在同一天多次观看同一个剧集，只算1次播放量（因为系统只记录最后一次观看进度）
- 例如：用户A在1月8日观看了系列1的剧集1、剧集2、剧集3，那么系列1在1月8日的播放量就是3

**业务含义**：反映内容的受欢迎程度和用户活跃度。

---

### 2. 平均观看时长

**定义**：平均日观看时长 = 当天所有用户观看时长总和 ÷ 当天日活数。

**数据来源**：
- **优先使用**：`watch_logs` 表（观看日志表，2026年1月后的新数据）
- **降级使用**：`watch_progress` 表（观看进度表，历史数据）

**计算方式**：
- 从 `watch_logs` 表中统计当天所有用户的实际观看时长总和（`watch_duration` 字段）
- 除以当天的活跃用户数（日活数，即去重的用户数）
- 四舍五入到整数

**观看时长的记录逻辑**：
- 每次用户更新观看进度时，系统会自动记录一条观看日志
- `watch_duration` = 本次观看结束位置 - 上次观看位置
- 例如：用户上次看到第100秒，本次看到第150秒，则记录观看时长为50秒

**说明**：
- ✅ 同一用户在同一天观看多个剧集，观看时长会累加
- ✅ 同一用户在同一天多次观看同一个剧集，观看时长也会累加（这是新系统的改进）
- ⚠️ **历史数据说明**：2026年1月之前的数据由于系统限制，使用的是 `watch_progress` 表，可能不够准确

**示例1（基本场景）**：
- 当天有3位用户产生观看行为
- 用户A：看了20分钟（1200秒）
- 用户B：看了10分钟（600秒）
- 用户C：看了30分钟（1800秒）
- 总观看时长 = 1200 + 600 + 1800 = 3600秒
- 平均日观看时长 = 3600 ÷ 3 = 1200秒（20分钟）

**示例2（多次观看场景）**：
- 用户A：
  - 上午看剧集1，从0秒看到300秒 → 记录300秒
  - 晚上看剧集1，从300秒看到1200秒 → 记录900秒
  - 当日总计：300 + 900 = 1200秒
- 用户B：看剧集2，从0秒看到600秒 → 记录600秒
- 用户C：看剧集3，从0秒看到1800秒 → 记录1800秒
- 总观看时长 = 1200 + 600 + 1800 = 3600秒
- 平均日观看时长 = 3600 ÷ 3 = 1200秒（20分钟）

**业务含义**：反映用户的平均观看投入度，平均观看时长越长，说明用户越愿意在平台上花费时间。

---

### 3. 完播率

**定义**：观看进度达到剧集时长90%以上的观看记录占比。

**计算方式**：
- 统计所有观看记录中，观看进度 >= 剧集时长 × 90% 的记录数
- 完播率 = 完播记录数 / 总记录数
- 保留4位小数（如：0.6500 表示 65%）

**示例**：
- 10条观看记录中，有6条的观看进度 >= 剧集时长的90%
- 完播率 = 6 / 10 = 0.6000（即 60%）

**业务含义**：反映内容的完成度，完播率越高，说明用户越愿意看完内容。

---

### 4. 点赞数

**定义**：在指定日期范围内，该系列下所有剧集收到的点赞总数。

**说明**：
- 统计该系列下所有剧集的点赞数之和
- 例如：系列1的剧集1收到5个赞，剧集2收到3个赞 → 系列1的点赞数 = 8

**业务含义**：反映用户对内容的正面反馈。

---

### 5. 点踩数

**定义**：在指定日期范围内，该系列下所有剧集收到的点踩总数。

**说明**：
- 统计该系列下所有剧集的点踩数之和
- 例如：系列1的剧集1收到2个踩，剧集2收到1个踩 → 系列1的点踩数 = 3

**业务含义**：反映用户对内容的负面反馈。

---

### 6. 收藏数

**定义**：在指定日期范围内，有多少个用户收藏了该系列。

**说明**：
- 统计收藏动作发生的日期，而不是系列被收藏的总数
- 例如：1月8日有3个用户收藏了系列1 → 系列1在1月8日的收藏数 = 3

**业务含义**：反映用户对内容的收藏意愿。

---

### 7. 评论数

**定义**：在指定日期范围内，该系列下所有剧集收到的评论总数。

**说明**：
- 统计该系列下所有剧集的评论数之和
- 包括主评论和回复评论
- 例如：系列1的剧集1收到10条评论，剧集2收到5条评论 → 系列1的评论数 = 15

**业务含义**：反映用户对内容的讨论热度。

---

### 8. 留存率

**定义**：某一天注册的用户，在N天后仍然活跃的用户占比。

**计算方式**：
- 选定一个队列日期（cohort date），统计该日注册的所有用户
- 统计这些用户在N天后是否有观看行为
- 留存率 = N天后活跃用户数 / 队列日期注册用户数
- 保留2位小数（如：0.45 表示 45%）

**常见类型**：
- **次日留存（Day 1 Retention）**：注册用户在第2天是否活跃
- **7日留存（Day 7 Retention）**：注册用户在第8天是否活跃

**示例**：
- 1月1日注册了100个用户
- 1月2日（次日）有45个用户产生了观看行为
- 次日留存率 = 45 / 100 = 0.45（即 45%）

**业务含义**：反映产品的用户粘性，留存率越高，说明用户越愿意持续使用产品。

---

## 常见问题

### Q1：为什么播放量不是观看次数？

**A**：播放量统计的是"用户-剧集"对的数量，而不是观看次数。因为系统设计上，一个用户对一个剧集只有一条观看记录，每次观看会更新这条记录的观看进度和时间戳，但记录数还是1条。这样设计是为了避免重复统计，更准确地反映内容的受欢迎程度。

### Q2：平均观看时长和总观看时长有什么区别？

**A**：
- **总观看时长**：所有观看记录的观看进度之和（例如：1200+600+1800=3600秒）
- **平均日观看时长**：总观看时长除以活跃用户数（例如：3600/3=1200秒）

### Q3：为什么平均观看时长是除以活跃用户数，而不是观看记录数？

**A**：新的定义更符合业务需求，反映的是"平均每个用户在当天观看了多长时间"，而不是"平均每条观看记录有多长"。这样可以更准确地衡量用户的投入度。例如：
- 用户A在某天看了10个剧集，每个看了2分钟，总共20分钟
- 用户B在某天看了1个剧集，看了20分钟
- 按旧逻辑：平均观看时长 = (10×2 + 1×20) / 11 = 3.6分钟
- 按新逻辑：平均观看时长 = (20 + 20) / 2 = 20分钟
- 新逻辑更能反映"用户平均在平台上花费的时间"

### Q4：为什么有两个数据表？watch_logs 和 watch_progress 有什么区别？

**A**：两个表的用途不同：

| 特性 | watch_progress（观看进度） | watch_logs（观看日志） |
|------|---------------------------|----------------------|
| **用途** | 断点续播功能 | 统计分析 |
| **记录方式** | 覆盖更新（每个用户-剧集只有1条） | 追加记录（每次观看都新增） |
| **存储内容** | 观看到第几秒（位置） | 观看了多长时间（时长） |
| **数据特点** | 只保留最新状态 | 保留完整历史 |
| **启用时间** | 一直存在 | 2026年1月后启用 |

**示例说明**：
- 用户A在1月1日看剧集1，看到第100秒
  - `watch_progress`：记录 `stop_at_second=100`
  - `watch_logs`：记录 `watch_duration=100`（从0看到100）
- 用户A在1月1日再次看剧集1，看到第150秒
  - `watch_progress`：**更新** `stop_at_second=150`（覆盖原记录）
  - `watch_logs`：**新增** `watch_duration=50`（从100看到150）
- 结果：
  - `watch_progress`：只有1条记录，显示最终位置是150秒
  - `watch_logs`：有2条记录，总观看时长 = 100 + 50 = 150秒

### Q5：历史数据的统计会受影响吗？

**A**：不会。系统采用了优雅降级策略：
- **新数据**（2026年1月后）：优先使用 `watch_logs` 表，数据更准确
- **旧数据**（2026年1月前）：自动降级使用 `watch_progress` 表，保持兼容
- **过渡期**：系统会自动判断，哪个表有数据就用哪个
- **未来**：当所有数据都迁移到新系统后，统计将完全基于 `watch_logs` 表
