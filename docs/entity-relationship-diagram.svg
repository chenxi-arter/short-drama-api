<svg width="1800" height="1200" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .entity-box { fill: #f8f9fa; stroke: #343a40; stroke-width: 2; }
      .entity-title { fill: #495057; font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .entity-field { fill: #6c757d; font-family: Arial, sans-serif; font-size: 11px; }
      .primary-key { fill: #dc3545; font-weight: bold; }
      .foreign-key { fill: #007bff; }
      .uuid-field { fill: #28a745; font-weight: bold; }
      .security-field { fill: #fd7e14; font-weight: bold; }
      .relationship-line { stroke: #6c757d; stroke-width: 2; fill: none; }
      .one-to-many { stroke: #28a745; }
      .many-to-many { stroke: #ffc107; }
      .one-to-one { stroke: #17a2b8; }
      .security-badge { fill: #dc3545; font-size: 12px; font-weight: bold; }
    </style>
  </defs>
  
  <!-- Title -->
  <text x="900" y="30" text-anchor="middle" class="entity-title" font-size="20">短剧API系统 - 实体关系图 v2.0.0 (UUID安全版)</text>
  <text x="900" y="50" text-anchor="middle" class="entity-field" font-size="12">🔒 包含UUID防枚举攻击和AccessKey播放保护</text>
  
  <!-- User Entity -->
  <g id="user-entity">
    <rect x="50" y="80" width="200" height="160" class="entity-box"/>
    <text x="150" y="100" text-anchor="middle" class="entity-title">User (用户)</text>
    <line x1="60" y1="105" x2="240" y2="105" stroke="#343a40" stroke-width="1"/>
    <text x="60" y="120" class="entity-field primary-key">🔑 id: bigint (PK)</text>
    <text x="60" y="135" class="entity-field">telegram_id: bigint (UNIQUE)</text>
    <text x="60" y="150" class="entity-field">first_name: varchar(255)</text>
    <text x="60" y="165" class="entity-field">last_name: varchar(255)</text>
    <text x="60" y="180" class="entity-field">username: varchar(255)</text>
    <text x="60" y="195" class="entity-field">is_active: tinyint</text>
    <text x="60" y="210" class="entity-field">created_at: timestamp</text>
    <text x="60" y="225" class="entity-field">🔗 refresh_tokens: RefreshToken[]</text>
  </g>
  
  <!-- RefreshToken Entity -->
  <g id="refresh-token-entity">
    <rect x="300" y="80" width="220" height="180" class="entity-box"/>
    <text x="410" y="100" text-anchor="middle" class="entity-title">RefreshToken (刷新令牌)</text>
    <line x1="310" y1="105" x2="510" y2="105" stroke="#343a40" stroke-width="1"/>
    <text x="310" y="120" class="entity-field primary-key">🔑 id: bigint (PK)</text>
    <text x="310" y="135" class="entity-field foreign-key">🔗 user_id: bigint (FK)</text>
    <text x="310" y="150" class="entity-field">token: varchar(255) (UNIQUE)</text>
    <text x="310" y="165" class="entity-field">expires_at: timestamp</text>
    <text x="310" y="180" class="entity-field">created_at: timestamp</text>
    <text x="310" y="195" class="entity-field">is_revoked: tinyint</text>
    <text x="310" y="210" class="entity-field">device_info: varchar(500)</text>
    <text x="310" y="225" class="entity-field">ip_address: varchar(45)</text>
    <text x="310" y="240" class="entity-field">🔗 user: User</text>
  </g>
  
  <!-- Category Entity -->
  <g id="category-entity">
    <rect x="570" y="80" width="200" height="140" class="entity-box"/>
    <text x="670" y="100" text-anchor="middle" class="entity-title">Category (分类)</text>
    <line x1="580" y1="105" x2="760" y2="105" stroke="#343a40" stroke-width="1"/>
    <text x="580" y="120" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="580" y="135" class="entity-field">name: varchar(100) (UNIQUE)</text>
    <text x="580" y="150" class="entity-field">description: text</text>
    <text x="580" y="165" class="entity-field">sort_order: int</text>
    <text x="580" y="180" class="entity-field">is_active: tinyint</text>
    <text x="580" y="195" class="entity-field">🔗 series: Series[]</text>
    <text x="580" y="210" class="entity-field">🔗 videos: Video[]</text>
  </g>
  
  <!-- Tag Entity - REMOVED: 已移除标签系统，改为通过category_id直接关联分类 -->
  
  <!-- FilterType Entity -->
  <g id="filter-type-entity">
    <rect x="1070" y="80" width="220" height="160" class="entity-box"/>
    <text x="1180" y="100" text-anchor="middle" class="entity-title">FilterType (筛选器类型)</text>
    <line x1="1080" y1="105" x2="1280" y2="105" stroke="#343a40" stroke-width="1"/>
    <text x="1080" y="120" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="1080" y="135" class="entity-field">name: varchar(50) (UNIQUE)</text>
    <text x="1080" y="150" class="entity-field">code: varchar(50) (UNIQUE)</text>
    <text x="1080" y="165" class="entity-field">index_position: int</text>
    <text x="1080" y="180" class="entity-field">is_active: tinyint</text>
    <text x="1080" y="195" class="entity-field">sort_order: int</text>
    <text x="1080" y="210" class="entity-field">created_at: timestamp</text>
    <text x="1080" y="225" class="entity-field">🔗 options: FilterOption[]</text>
  </g>
  
  <!-- FilterOption Entity -->
  <g id="filter-option-entity">
    <rect x="1340" y="80" width="220" height="180" class="entity-box"/>
    <text x="1450" y="100" text-anchor="middle" class="entity-title">FilterOption (筛选器选项)</text>
    <line x1="1350" y1="105" x2="1550" y2="105" stroke="#343a40" stroke-width="1"/>
    <text x="1350" y="120" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="1350" y="135" class="entity-field foreign-key">🔗 filter_type_id: int (FK)</text>
    <text x="1350" y="150" class="entity-field">name: varchar(100)</text>
    <text x="1350" y="165" class="entity-field">value: varchar(100)</text>
    <text x="1350" y="180" class="entity-field">is_default: tinyint</text>
    <text x="1350" y="195" class="entity-field">is_active: tinyint</text>
    <text x="1350" y="210" class="entity-field">sort_order: int</text>
    <text x="1350" y="225" class="entity-field">created_at: timestamp</text>
    <text x="1350" y="240" class="entity-field">🔗 filter_type: FilterType</text>
  </g>
  
  <!-- Series Entity (with UUID) -->
  <g id="series-entity">
    <rect x="50" y="300" width="260" height="280" class="entity-box"/>
    <text x="180" y="320" text-anchor="middle" class="entity-title">Series (剧集系列) 🔒</text>
    <text x="280" y="320" class="security-badge">UUID</text>
    <line x1="60" y1="325" x2="300" y2="325" stroke="#343a40" stroke-width="1"/>
    <text x="60" y="340" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="60" y="355" class="entity-field uuid-field">🔒 uuid: varchar(36) (UNIQUE)</text>
    <text x="60" y="370" class="entity-field foreign-key">🔗 category_id: int (FK)</text>
    <text x="60" y="385" class="entity-field">title: varchar(255)</text>
    <text x="60" y="400" class="entity-field">description: text</text>
    <text x="60" y="415" class="entity-field">cover_image: varchar(500)</text>
    <text x="60" y="430" class="entity-field">total_episodes: int</text>
    <text x="60" y="445" class="entity-field">status: enum</text>
    <text x="60" y="460" class="entity-field">rating: decimal(3,2)</text>
    <text x="60" y="475" class="entity-field">view_count: bigint</text>
    <text x="60" y="490" class="entity-field">like_count: bigint</text>
    <text x="60" y="505" class="entity-field">starring: text</text>
    <text x="60" y="520" class="entity-field">director: varchar(255)</text>
    <text x="60" y="535" class="entity-field">is_featured: tinyint</text>
    <text x="60" y="550" class="entity-field">is_active: tinyint</text>
    <text x="60" y="565" class="entity-field">🔗 episodes: Episode[]</text>
  </g>
  
  <!-- Episode Entity (with UUID) -->
  <g id="episode-entity">
    <rect x="360" y="300" width="240" height="240" class="entity-box"/>
    <text x="480" y="320" text-anchor="middle" class="entity-title">Episode (剧集) 🔒</text>
    <text x="570" y="320" class="security-badge">UUID</text>
    <line x1="370" y1="325" x2="590" y2="325" stroke="#343a40" stroke-width="1"/>
    <text x="370" y="340" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="370" y="355" class="entity-field uuid-field">🔒 uuid: varchar(36) (UNIQUE)</text>
    <text x="370" y="370" class="entity-field foreign-key">🔗 series_id: int (FK)</text>
    <text x="370" y="385" class="entity-field">episode_number: int</text>
    <text x="370" y="400" class="entity-field">title: varchar(255)</text>
    <text x="370" y="415" class="entity-field">description: text</text>
    <text x="370" y="430" class="entity-field">video_url: varchar(500)</text>
    <text x="370" y="445" class="entity-field">thumbnail: varchar(500)</text>
    <text x="370" y="460" class="entity-field">duration: int</text>
    <text x="370" y="475" class="entity-field">view_count: bigint</text>
    <text x="370" y="490" class="entity-field">like_count: bigint</text>
    <text x="370" y="505" class="entity-field">is_active: tinyint</text>
    <text x="370" y="520" class="entity-field">🔗 episode_urls: EpisodeUrl[]</text>
    <text x="370" y="535" class="entity-field">🔗 comments: Comment[]</text>
  </g>
  
  <!-- EpisodeUrl Entity (with AccessKey) -->
  <g id="episode-url-entity">
    <rect x="650" y="300" width="240" height="200" class="entity-box"/>
    <text x="770" y="320" text-anchor="middle" class="entity-title">EpisodeUrl (播放地址) 🔒</text>
    <text x="860" y="320" class="security-badge">KEY</text>
    <line x1="660" y1="325" x2="880" y2="325" stroke="#343a40" stroke-width="1"/>
    <text x="660" y="340" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="660" y="355" class="entity-field foreign-key">🔗 episode_id: int (FK)</text>
    <text x="660" y="370" class="entity-field security-field">🔒 access_key: varchar(64) (UNIQUE)</text>
    <text x="660" y="385" class="entity-field">url: varchar(500)</text>
    <text x="660" y="400" class="entity-field">quality: varchar(20)</text>
    <text x="660" y="415" class="entity-field">file_size: bigint</text>
    <text x="660" y="430" class="entity-field">format: varchar(10)</text>
    <text x="660" y="445" class="entity-field">is_active: tinyint</text>
    <text x="660" y="460" class="entity-field">created_at: timestamp</text>
    <text x="660" y="475" class="entity-field">🔗 episode: Episode</text>
  </g>
  
  <!-- Video Entity (with UUID) -->
  <g id="video-entity">
    <rect x="950" y="300" width="240" height="220" class="entity-box"/>
    <text x="1070" y="320" text-anchor="middle" class="entity-title">Video (短视频) 🔒</text>
    <text x="1160" y="320" class="security-badge">UUID</text>
    <line x1="960" y1="325" x2="1180" y2="325" stroke="#343a40" stroke-width="1"/>
    <text x="960" y="340" class="entity-field primary-key">🔑 id: int (PK)</text>
    <text x="960" y="355" class="entity-field uuid-field">🔒 uuid: varchar(36) (UNIQUE)</text>
    <text x="960" y="370" class="entity-field foreign-key">🔗 category_id: int (FK)</text>
    <text x="960" y="385" class="entity-field">title: varchar(255)</text>
    <text x="960" y="400" class="entity-field">description: text</text>
    <text x="960" y="415" class="entity-field">video_url: varchar(500)</text>
    <text x="960" y="430" class="entity-field">thumbnail: varchar(500)</text>
    <text x="960" y="445" class="entity-field">duration: int</text>
    <text x="960" y="460" class="entity-field">view_count: bigint</text>
    <text x="960" y="475" class="entity-field">like_count: bigint</text>
    <text x="960" y="490" class="entity-field">is_featured: tinyint</text>
    <text x="960" y="505" class="entity-field">is_active: tinyint</text>
  </g>
  
  <!-- Comment Entity -->
  <g id="comment-entity">
    <rect x="50" y="620" width="240" height="200" class="entity-box"/>
    <text x="170" y="640" text-anchor="middle" class="entity-title">Comment (评论/弹幕)</text>
    <line x1="60" y1="645" x2="280" y2="645" stroke="#343a40" stroke-width="1"/>
    <text x="60" y="660" class="entity-field primary-key">🔑 id: bigint (PK)</text>
    <text x="60" y="675" class="entity-field foreign-key">🔗 user_id: bigint (FK)</text>
    <text x="60" y="690" class="entity-field">content_type: enum</text>
    <text x="60" y="705" class="entity-field">content_id: int</text>
    <text x="60" y="720" class="entity-field">content: text</text>
    <text x="60" y="735" class="entity-field">comment_type: enum</text>
    <text x="60" y="750" class="entity-field">time_position: int</text>
    <text x="60" y="765" class="entity-field">parent_id: bigint</text>
    <text x="60" y="780" class="entity-field">like_count: int</text>
    <text x="60" y="795" class="entity-field">is_active: tinyint</text>
    <text x="60" y="810" class="entity-field">🔗 user: User</text>
  </g>
  
  <!-- WatchProgress Entity -->
  <g id="watch-progress-entity">
    <rect x="340" y="620" width="240" height="180" class="entity-box"/>
    <text x="460" y="640" text-anchor="middle" class="entity-title">WatchProgress (观看进度)</text>
    <line x1="350" y1="645" x2="570" y2="645" stroke="#343a40" stroke-width="1"/>
    <text x="350" y="660" class="entity-field primary-key">🔑 id: bigint (PK)</text>
    <text x="350" y="675" class="entity-field foreign-key">🔗 user_id: bigint (FK)</text>
    <text x="350" y="690" class="entity-field">content_type: enum</text>
    <text x="350" y="705" class="entity-field">content_id: int</text>
    <text x="350" y="720" class="entity-field">progress_seconds: int</text>
    <text x="350" y="735" class="entity-field">total_seconds: int</text>
    <text x="350" y="750" class="entity-field">is_completed: tinyint</text>
    <text x="350" y="765" class="entity-field">last_watched_at: timestamp</text>
    <text x="350" y="780" class="entity-field">🔗 user: User</text>
  </g>
  
  <!-- Series Tags Junction Table - REMOVED: 已移除，改为通过category_id直接关联 -->
  
  <!-- Episode Tags Junction Table - REMOVED: 已移除，改为通过category_id直接关联 -->
  
  <!-- Video Tags Junction Table - REMOVED: 已移除，改为通过category_id直接关联 -->
  
  <!-- Relationship Lines -->
  
  <!-- User -> RefreshToken (1:N) -->
  <path d="M 250 180 L 300 180" class="relationship-line one-to-many"/>
  <text x="275" y="175" class="entity-field" font-size="10">1:N</text>
  
  <!-- User -> Comment (1:N) -->
  <path d="M 150 240 L 150 620" class="relationship-line one-to-many"/>
  <text x="155" y="430" class="entity-field" font-size="10">1:N</text>
  
  <!-- User -> WatchProgress (1:N) -->
  <path d="M 200 240 L 400 620" class="relationship-line one-to-many"/>
  <text x="300" y="430" class="entity-field" font-size="10">1:N</text>
  
  <!-- Category -> Series (1:N) -->
  <path d="M 620 220 L 250 300" class="relationship-line one-to-many"/>
  <text x="435" y="260" class="entity-field" font-size="10">1:N</text>
  
  <!-- Category -> Video (1:N) -->
  <path d="M 720 220 L 1000 300" class="relationship-line one-to-many"/>
  <text x="860" y="260" class="entity-field" font-size="10">1:N</text>
  
  <!-- Series -> Episode (1:N) -->
  <path d="M 310 420 L 360 420" class="relationship-line one-to-many"/>
  <text x="335" y="415" class="entity-field" font-size="10">1:N</text>
  
  <!-- Episode -> EpisodeUrl (1:N) -->
  <path d="M 600 400 L 650 400" class="relationship-line one-to-many"/>
  <text x="625" y="395" class="entity-field" font-size="10">1:N</text>
  
  <!-- Episode -> Comment (1:N) -->
  <path d="M 480 540 L 170 620" class="relationship-line one-to-many"/>
  <text x="325" y="580" class="entity-field" font-size="10">1:N</text>
  
  <!-- Tag-related relationships REMOVED: 标签系统已移除，改为通过category_id直接关联 -->
  
  <!-- FilterType -> FilterOption (1:N) -->
  <path d="M 1290 180 L 1340 180" class="relationship-line one-to-many"/>
  <text x="1315" y="175" class="entity-field" font-size="10">1:N</text>
  
  <!-- Business Logic Relationships (Dashed Lines) -->
  
  <!-- FilterType -> Series (Business Logic: 筛选器作用于剧集系列) -->
  <path d="M 1180 240 L 1180 280 L 300 280 L 300 300" class="relationship-line" stroke-dasharray="5,5" stroke="#ffc107"/>
  <text x="740" y="275" class="entity-field" font-size="10" fill="#ffc107">业务关联: 筛选器作用于Series</text>
  
  <!-- FilterOption -> Series (Business Logic: 筛选选项过滤剧集) -->
  <path d="M 1450 260 L 1450 290 L 320 290 L 320 300" class="relationship-line" stroke-dasharray="5,5" stroke="#fd7e14"/>
  <text x="885" y="285" class="entity-field" font-size="10" fill="#fd7e14">业务关联: 筛选选项过滤Series</text>
  
  <!-- Security Features Legend -->
  <g id="security-legend">
    <rect x="50" y="880" width="500" height="320" fill="#f8f9fa" stroke="#343a40" stroke-width="2"/>
    <text x="300" y="905" text-anchor="middle" class="entity-title" font-size="16">🔒 安全特性图例</text>
    <line x1="60" y1="915" x2="540" y2="915" stroke="#343a40" stroke-width="1"/>
    
    <text x="70" y="935" class="entity-field primary-key">🔑 主键 (Primary Key)</text>
    <text x="70" y="950" class="entity-field foreign-key">🔗 外键 (Foreign Key)</text>
    <text x="70" y="965" class="entity-field uuid-field">🔒 UUID字段 (防枚举攻击)</text>
    <text x="70" y="980" class="entity-field security-field">🔒 AccessKey字段 (播放保护)</text>
    <text x="70" y="995" class="entity-field">🔗 关系字段 (Relationship Field)</text>
    
    <line x1="70" y1="1015" x2="120" y2="1015" class="relationship-line one-to-many"/>
    <text x="130" y="1020" class="entity-field">一对多关系 (1:N)</text>
    
    <line x1="70" y1="1035" x2="120" y2="1035" class="relationship-line many-to-many"/>
    <text x="130" y="1040" class="entity-field">多对多关系 (M:N)</text>
    
    <line x1="70" y1="1055" x2="120" y2="1055" class="relationship-line" stroke-dasharray="5,5" stroke="#ffc107"/>
    <text x="130" y="1060" class="entity-field">业务逻辑关联 (虚线)</text>
    
    <text x="70" y="1080" class="entity-field" font-size="12">🔒 安全实体标识:</text>
    <text x="70" y="1095" class="entity-field" font-size="10">• Series, Episode, Video: 包含UUID防枚举</text>
    <text x="70" y="1110" class="entity-field" font-size="10">• EpisodeUrl: 包含AccessKey播放保护</text>
    <text x="70" y="1125" class="entity-field" font-size="10">• 分类关联: 通过category_id直接关联优化</text>
    <text x="70" y="1140" class="entity-field" font-size="10">• 筛选器关联: 通过业务逻辑作用于Series</text>
    
    <text x="70" y="1160" class="entity-field" font-size="12">📊 性能优化:</text>
    <text x="70" y="1175" class="entity-field" font-size="10">• UUID字段: 唯一索引 + 查询优化</text>
    <text x="70" y="1190" class="entity-field" font-size="10">• 外键字段: 普通索引提升JOIN性能</text>
  </g>
  
  <!-- Version Info Legend -->
  <g id="version-legend">
    <rect x="600" y="880" width="400" height="200" fill="#e9ecef" stroke="#343a40" stroke-width="2"/>
    <text x="800" y="905" text-anchor="middle" class="entity-title" font-size="16">版本信息</text>
    <line x1="610" y1="915" x2="990" y2="915" stroke="#343a40" stroke-width="1"/>
    
    <text x="620" y="935" class="entity-field" font-size="12">版本: v2.0.0 (UUID安全版)</text>
    <text x="620" y="950" class="entity-field" font-size="12">更新日期: 2025-01-31</text>
    <text x="620" y="965" class="entity-field" font-size="12">实体数量: 11个核心实体</text>
    <text x="620" y="980" class="entity-field" font-size="12">关系数量: 8个主要关联</text>
    
    <text x="620" y="1005" class="entity-field" font-size="12">🆕 v2.0.0 新增特性:</text>
    <text x="620" y="1020" class="entity-field" font-size="10">• UUID防枚举攻击保护</text>
    <text x="620" y="1035" class="entity-field" font-size="10">• AccessKey播放地址保护</text>
    <text x="620" y="1050" class="entity-field" font-size="10">• 筛选器系统完整支持及业务关联可视化</text>
    <text x="620" y="1065" class="entity-field" font-size="10">• 索引优化和性能提升</text>
  </g>
  
  <!-- Statistics Legend -->
  <g id="stats-legend">
    <rect x="1050" y="880" width="400" height="200" fill="#d1ecf1" stroke="#343a40" stroke-width="2"/>
    <text x="1250" y="905" text-anchor="middle" class="entity-title" font-size="16">数据库统计</text>
    <line x1="1060" y1="915" x2="1440" y2="915" stroke="#343a40" stroke-width="1"/>
    
    <text x="1070" y="935" class="entity-field" font-size="12">🔒 安全实体: 4个 (Series, Episode, Video, EpisodeUrl)</text>
    <text x="1070" y="950" class="entity-field" font-size="12">🔗 关联表: 0个 (标签系统已移除)</text>
    <text x="1070" y="965" class="entity-field" font-size="12">📊 筛选器: 2个 (FilterType, FilterOption)</text>
    <text x="1070" y="980" class="entity-field" font-size="12">👤 用户相关: 3个 (User, RefreshToken, Comment)</text>
    
    <text x="1070" y="1005" class="entity-field" font-size="12">🎯 索引策略:</text>
    <text x="1070" y="1020" class="entity-field" font-size="10">• 主键索引: 11个 (自动创建)</text>
    <text x="1070" y="1035" class="entity-field" font-size="10">• 唯一索引: 8个 (UUID + 业务唯一)</text>
    <text x="1070" y="1050" class="entity-field" font-size="10">• 外键索引: 8个 (关联查询优化)</text>
    <text x="1070" y="1065" class="entity-field" font-size="10">• 复合索引: 2个 (多字段查询优化)</text>
  </g>
  
  <!-- Footer -->
  <text x="900" y="1130" text-anchor="middle" class="entity-field" font-size="14">短剧API系统数据库实体关系图 v2.0.0 - 包含UUID防枚举攻击和AccessKey播放保护</text>
  <text x="900" y="1150" text-anchor="middle" class="entity-field" font-size="12">🔒 安全特性 | 📊 性能优化 | 🔗 分类关联 | 📈 简化架构</text>
  <text x="900" y="1170" text-anchor="middle" class="entity-field" font-size="10">生成时间: 2025-01-31 | 版本: v2.0.0 | 移除标签系统，改为分类直接关联</text>
</svg>